name: Android-Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    # ============= INSTALAR HAXE =============
    - name: Instalar Haxe
      uses: krdlab/setup-haxe@v1
      with:
        haxe-version: 4.2.5

    # ============= CONFIGURAR HAXELIB =============
    - name: Configurar Haxelib
      run: |
        mkdir -p haxelib
        haxelib setup haxelib

    # ============= INSTALAR DEPENDÃŠNCIAS =============
    - name: Instalar haxelibs
      run: |
        haxelib install lime
        haxelib install openfl
        haxelib install actuate
        haxelib install flixel
        haxelib install flixel-addons
        haxelib install flixel-ui
        haxelib install hxcpp
        haxelib install linc_luajit --always --quiet || true

        # Psych Engine usa:
        haxelib install hscript
        haxelib install hxjson2

        # Nightmare Engine usa:
        haxelib install hxCodec --always || true

        haxelib list

    # ============= CONFIGURAR ANDROID =============
    - name: Setup Android
      run: |
        haxelib run lime setup android --accept --no-android-tools

    # ============= COMPILAR APK =============
    - name: Build APK
      run: |
        haxelib run lime build android -release

    # ============= ENVIAR O APK =============
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: APK-Final
        path: export/release/android/bin/app.apk
